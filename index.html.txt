<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Adivinhe a Cor - Tema Escuro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: 'Inter', sans-serif;
            touch-action: manipulation;
            background-color: #111827; /* bg-gray-900 */
            color: #d1d5db; /* text-gray-300 */
        }
        .slider-thumb::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #f9fafb;
            margin-top: -8px;
        }
        .slider-thumb::-moz-range-thumb {
            width: 22px;
            height: 22px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #f9fafb;
        }
        .slider-track {
            height: 6px;
            border-radius: 3px;
        }
        .popup, .history-popup { /* Combined common styles */
            display: none;
            position: fixed;
            z-index: 100;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.75); /* Slightly darker overlay */
            align-items: center;
            justify-content: center;
            padding: 1rem; /* Padding for the overlay itself */
        }
        .popup-content, .history-popup-content { /* Combined common styles */
            background-color: #1f2937; /* bg-gray-800 */
            color: #d1d5db; /* text-gray-300 */
            margin: auto;
            padding: 24px;
            border: 1px solid #374151; /* bg-gray-700 */
            width: 90%;
            max-width: 450px; /* Slightly wider for history */
            border-radius: 12px;
            text-align: center;
            box-shadow: 0 10px 25px -5px rgba(0,0,0,0.3), 0 20px 40px -20px rgba(0,0,0,0.5);
            position: relative; /* For absolute positioning of close button */
        }
        .history-popup-content {
             max-height: 80vh; /* Max height for history popup */
             overflow-y: auto; /* Scroll for long history */
        }
        .close-button {
            color: #9ca3af;
            position: absolute; /* Positioned relative to popup-content */
            top: 12px;
            right: 16px;
            font-size: 32px;
            font-weight: bold;
            cursor: pointer;
            line-height: 1;
        }
        .close-button:hover,
        .close-button:focus {
            color: #f3f4f6;
            text-decoration: none;
        }
        .btn-active:active {
            transform: scale(0.96);
            opacity: 0.85;
        }
        .adjust-btn {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            border-radius: 8px;
        }
        input[type="range"]:focus { outline: none; }
        input[type="range"].focus-visible:focus { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); }
        button:focus { outline: none; }
        button.focus-visible:focus { box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.5); }

        .history-item {
            background-color: #374151; /* bg-gray-700 */
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            text-align: left;
            font-size: 0.875rem; /* text-sm */
        }
        .history-item p {
            margin-bottom: 4px;
        }
        .history-item strong {
            color: #a5b4fc; /* indigo-300 */
        }
        .history-color-preview {
            display: inline-block;
            width: 1em;
            height: 1em;
            border-radius: 3px;
            margin-right: 0.5em;
            vertical-align: middle;
            border: 1px solid #4b5563; /* gray-600 */
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-md bg-gray-800 p-6 sm:p-8 rounded-xl shadow-2xl relative">
        <button id="historyButton" class="absolute top-4 right-4 bg-gray-700 hover:bg-gray-600 text-gray-300 font-semibold py-2 px-3 rounded-lg text-sm shadow-md focus-visible btn-active">
            Hist√≥rico
        </button>

        <h1 class="text-3xl font-bold text-center text-gray-100 mb-8 pt-8 sm:pt-0">Adivinhe a Cor</h1>

        <div class="flex justify-around mb-8 space-x-4">
            <div class="w-1/2 aspect-square rounded-lg shadow-lg flex items-center justify-center border-2 border-gray-700" id="targetColorSquare">
                <p class="text-xs text-gray-300 bg-black bg-opacity-40 px-2 py-1 rounded-md">Cor Alvo</p>
            </div>
            <div class="w-1/2 aspect-square rounded-lg shadow-lg flex items-center justify-center border-2 border-gray-700" id="userColorSquare">
                 <p class="text-xs text-gray-300 bg-black bg-opacity-40 px-2 py-1 rounded-md">Sua Cor</p>
            </div>
        </div>

        <div class="space-y-6 mb-8">
            <div>
                <label for="redSlider" class="block text-sm font-medium text-gray-300 mb-1">Vermelho: <span id="redValue" class="font-semibold">128</span></label>
                <input type="range" id="redSlider" min="0" max="255" value="128" class="w-full appearance-none cursor-pointer slider-thumb slider-track focus-visible">
                <div class="flex justify-between items-center mt-2.5">
                    <button id="redDecrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">-</button>
                    <button id="redIncrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">+</button>
                </div>
            </div>
            <div>
                <label for="greenSlider" class="block text-sm font-medium text-gray-300 mb-1">Verde: <span id="greenValue" class="font-semibold">128</span></label>
                <input type="range" id="greenSlider" min="0" max="255" value="128" class="w-full appearance-none cursor-pointer slider-thumb slider-track focus-visible">
                <div class="flex justify-between items-center mt-2.5">
                    <button id="greenDecrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">-</button>
                    <button id="greenIncrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">+</button>
                </div>
            </div>
            <div>
                <label for="blueSlider" class="block text-sm font-medium text-gray-300 mb-1">Azul: <span id="blueValue" class="font-semibold">128</span></label>
                <input type="range" id="blueSlider" min="0" max="255" value="128" class="w-full appearance-none cursor-pointer slider-thumb slider-track focus-visible">
                <div class="flex justify-between items-center mt-2.5">
                    <button id="blueDecrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">-</button>
                    <button id="blueIncrement" class="adjust-btn bg-gray-700 hover:bg-gray-600 text-gray-200 font-bold shadow-md btn-active focus-visible">+</button>
                </div>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
            <button id="confirmButton" class="w-full sm:w-1/2 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-3 px-4 rounded-lg shadow-lg focus-visible transition-all duration-150 ease-in-out transform btn-active">
                Confirmar
            </button>
            <button id="mainRestartButton" class="w-full sm:w-1/2 bg-gray-600 hover:bg-gray-500 text-gray-100 font-semibold py-3 px-4 rounded-lg shadow-lg focus-visible transition-all duration-150 ease-in-out transform btn-active">
                Reiniciar Jogo
            </button>
        </div>
    </div>

    <div id="scorePopup" class="popup">
        <div class="popup-content">
            <span class="close-button" id="closeScorePopup">&times;</span>
            <h2 class="text-2xl font-semibold mb-4 text-gray-100" id="popupTitle">Resultado</h2>
            <p class="mb-3 text-gray-300">Diferen√ßa Total: <strong id="scoreValue" class="text-3xl text-indigo-400"></strong></p>
            <div class="text-sm space-y-1 text-gray-400 mb-6">
                <p>Cor Alvo (RGB): <span id="targetRgbValue" class="font-mono"></span></p>
                <p>Sua Cor (RGB): <span id="userRgbValue" class="font-mono"></span></p>
            </div>
            <div class="flex flex-col sm:flex-row space-y-3 sm:space-y-0 sm:space-x-4">
                <button id="popupEditButton" class="w-full sm:w-1/2 bg-gray-600 hover:bg-gray-500 text-gray-100 font-semibold py-2.5 px-6 rounded-lg shadow-md focus-visible btn-active">
                    Editar
                </button>
                <button id="popupRestartButton" class="w-full sm:w-1/2 bg-indigo-600 hover:bg-indigo-500 text-white font-semibold py-2.5 px-6 rounded-lg shadow-md focus-visible btn-active">
                    Nova Cor (Reiniciar)
                </button>
            </div>
        </div>
    </div>

    <div id="historyPopup" class="history-popup">
        <div class="history-popup-content">
            <span class="close-button" id="closeHistoryPopup">&times;</span>
            <h2 class="text-2xl font-semibold mb-6 text-gray-100">Hist√≥rico de Pontua√ß√µes</h2>
            <div id="historyListContainer" class="max-h-60vh overflow-y-auto text-left">
                <p id="noHistoryText" class="text-gray-400 text-center">Nenhuma pontua√ß√£o registrada ainda.</p>
            </div>
             <button id="clearHistoryButton" class="mt-6 bg-red-700 hover:bg-red-600 text-white font-semibold py-2 px-6 rounded-lg shadow-md focus-visible btn-active">
                Limpar Hist√≥rico
            </button>
        </div>
    </div>


    <script>
        // DOM Elements
        const targetColorSquare = document.getElementById('targetColorSquare');
        const userColorSquare = document.getElementById('userColorSquare');
        const redSlider = document.getElementById('redSlider');
        const greenSlider = document.getElementById('greenSlider');
        const blueSlider = document.getElementById('blueSlider');
        const redValueSpan = document.getElementById('redValue');
        const greenValueSpan = document.getElementById('greenValue');
        const blueValueSpan = document.getElementById('blueValue');
        const confirmButton = document.getElementById('confirmButton');
        const mainRestartButton = document.getElementById('mainRestartButton'); // Renamed from restartButton

        const redDecrement = document.getElementById('redDecrement');
        const redIncrement = document.getElementById('redIncrement');
        const greenDecrement = document.getElementById('greenDecrement');
        const greenIncrement = document.getElementById('greenIncrement');
        const blueDecrement = document.getElementById('blueDecrement');
        const blueIncrement = document.getElementById('blueIncrement');

        // Score Popup Elements
        const scorePopup = document.getElementById('scorePopup');
        const closeScorePopup = document.getElementById('closeScorePopup');
        const popupTitle = document.getElementById('popupTitle');
        const scoreValueSpan = document.getElementById('scoreValue');
        const targetRgbValueSpan = document.getElementById('targetRgbValue');
        const userRgbValueSpan = document.getElementById('userRgbValue');
        const popupEditButton = document.getElementById('popupEditButton');
        const popupRestartButton = document.getElementById('popupRestartButton');

        // History Elements
        const historyButton = document.getElementById('historyButton');
        const historyPopup = document.getElementById('historyPopup');
        const closeHistoryPopup = document.getElementById('closeHistoryPopup');
        const historyListContainer = document.getElementById('historyListContainer');
        const noHistoryText = document.getElementById('noHistoryText');
        const clearHistoryButton = document.getElementById('clearHistoryButton');


        let targetRed, targetGreen, targetBlue;
        let scoreHistory = []; // Array to store score history

        // --- Core Game Logic ---
        function randomColorComponent() { return Math.floor(Math.random() * 256); }

        function setRandomTargetColor() {
            targetRed = randomColorComponent();
            targetGreen = randomColorComponent();
            targetBlue = randomColorComponent();
            targetColorSquare.style.backgroundColor = `rgb(${targetRed}, ${targetGreen}, ${targetBlue})`;
        }

        function updateUserColor() {
            const r = parseInt(redSlider.value);
            const g = parseInt(greenSlider.value);
            const b = parseInt(blueSlider.value);

            redValueSpan.textContent = r;
            greenValueSpan.textContent = g;
            blueValueSpan.textContent = b;
            userColorSquare.style.backgroundColor = `rgb(${r}, ${g}, ${b})`;

            redSlider.style.background = `linear-gradient(to right, rgb(0, ${g}, ${b}), rgb(255, ${g}, ${b}))`;
            greenSlider.style.background = `linear-gradient(to right, rgb(${r}, 0, ${b}), rgb(${r}, 255, ${b}))`;
            blueSlider.style.background = `linear-gradient(to right, rgb(${r}, ${g}, 0), rgb(${r}, ${g}, 255))`;

            document.documentElement.style.setProperty('--red-thumb-color', `rgb(${r}, 60, 60)`);
            document.documentElement.style.setProperty('--green-thumb-color', `rgb(60, ${g}, 60)`);
            document.documentElement.style.setProperty('--blue-thumb-color', `rgb(60, 60, ${b})`);
        }

        function calculateScore(r_target, g_target, b_target, r_user, g_user, b_user) {
            const diffR = Math.abs(r_target - r_user);
            const diffG = Math.abs(g_target - g_user);
            const diffB = Math.abs(b_target - b_user);
            return diffR + diffG + diffB;
        }

        // --- Popup Handling ---
        function showScorePopup(differenceScore, targetRgb, userRgb) {
            scoreValueSpan.textContent = differenceScore;
            targetRgbValueSpan.textContent = `(${targetRgb.r}, ${targetRgb.g}, ${targetRgb.b})`;
            userRgbValueSpan.textContent = `(${userRgb.r}, ${userRgb.g}, ${userRgb.b})`;

            if (differenceScore === 0) popupTitle.textContent = "Perfeito! üéâ";
            else if (differenceScore <= 15) popupTitle.textContent = "Quase l√°! Excelente! üëç";
            else if (differenceScore <= 45) popupTitle.textContent = "Muito Bom! üòä";
            else if (differenceScore <= 100) popupTitle.textContent = "Bom Esfor√ßo! üôÇ";
            else popupTitle.textContent = "Continue Tentando! ü§î";
            scorePopup.style.display = 'flex';
        }
        function hideScorePopup() { scorePopup.style.display = 'none'; }

        // --- History Handling ---
        function addToHistory(targetColor, userColor, difference) {
            const timestamp = new Date();
            scoreHistory.unshift({ // Add to the beginning for newest first
                target: targetColor,
                user: userColor,
                diff: difference,
                time: timestamp.toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' }) + ' ' + timestamp.toLocaleDateString('pt-BR')
            });
            renderHistory();
        }

        function renderHistory() {
            // Clear previous items except the 'no history' text
            while (historyListContainer.firstChild && historyListContainer.firstChild !== noHistoryText) {
                historyListContainer.removeChild(historyListContainer.firstChild);
            }

            if (scoreHistory.length === 0) {
                noHistoryText.style.display = 'block';
            } else {
                noHistoryText.style.display = 'none';
                scoreHistory.forEach(item => {
                    const historyDiv = document.createElement('div');
                    historyDiv.className = 'history-item';
                    historyDiv.innerHTML = `
                        <p><strong>Diferen√ßa:</strong> ${item.diff}</p>
                        <p><span class="history-color-preview" style="background-color: rgb(${item.target.r},${item.target.g},${item.target.b});"></span><strong>Alvo:</strong> rgb(${item.target.r}, ${item.target.g}, ${item.target.b})</p>
                        <p><span class="history-color-preview" style="background-color: rgb(${item.user.r},${item.user.g},${item.user.b});"></span><strong>Sua Cor:</strong> rgb(${item.user.r}, ${item.user.g}, ${item.user.b})</p>
                        <p class="text-xs text-gray-500">${item.time}</p>
                    `;
                    historyListContainer.insertBefore(historyDiv, noHistoryText); // Insert before 'no history' text
                });
            }
        }

        function showHistoryPopup() {
            renderHistory(); // Ensure it's up-to-date when shown
            historyPopup.style.display = 'flex';
        }
        function hideHistoryPopup() { historyPopup.style.display = 'none'; }

        function clearHistory() {
            if (confirm("Tem certeza que deseja limpar todo o hist√≥rico de pontua√ß√µes?")) {
                scoreHistory = [];
                renderHistory();
            }
        }


        // --- Event Listeners ---
        redSlider.addEventListener('input', updateUserColor);
        greenSlider.addEventListener('input', updateUserColor);
        blueSlider.addEventListener('input', updateUserColor);

        function setupAdjustButtonListeners(sliderElement, decrementButton, incrementButton) {
            decrementButton.addEventListener('click', () => {
                sliderElement.value = Math.max(0, parseInt(sliderElement.value) - 1);
                updateUserColor();
            });
            incrementButton.addEventListener('click', () => {
                sliderElement.value = Math.min(255, parseInt(sliderElement.value) + 1);
                updateUserColor();
            });
        }
        setupAdjustButtonListeners(redSlider, redDecrement, redIncrement);
        setupAdjustButtonListeners(greenSlider, greenDecrement, greenIncrement);
        setupAdjustButtonListeners(blueSlider, blueDecrement, blueIncrement);

        confirmButton.addEventListener('click', () => {
            const userR = parseInt(redSlider.value);
            const userG = parseInt(greenSlider.value);
            const userB = parseInt(blueSlider.value);
            const target = { r: targetRed, g: targetGreen, b: targetBlue };
            const user = { r: userR, g: userG, b: userB };
            const difference = calculateScore(target.r, target.g, target.b, user.r, user.g, user.b);

            showScorePopup(difference, target, user);
            addToHistory(target, user, difference); // Add to history on confirm
        });

        function performRestartGame() {
            setRandomTargetColor();
            redSlider.value = 128;
            greenSlider.value = 128;
            blueSlider.value = 128;
            updateUserColor();
        }

        mainRestartButton.addEventListener('click', () => {
            performRestartGame();
            // Decided not to clear history on main restart, user can use "Clear History" button
        });

        // Score Popup Buttons
        closeScorePopup.addEventListener('click', hideScorePopup);
        popupEditButton.addEventListener('click', hideScorePopup); // Just closes to allow editing
        popupRestartButton.addEventListener('click', () => {
            hideScorePopup();
            performRestartGame();
        });

        // History Popup Buttons
        historyButton.addEventListener('click', showHistoryPopup);
        closeHistoryPopup.addEventListener('click', hideHistoryPopup);
        clearHistoryButton.addEventListener('click', clearHistory);


        // Close popups if user clicks outside content
        window.addEventListener('click', (event) => {
            if (event.target === scorePopup) hideScorePopup();
            if (event.target === historyPopup) hideHistoryPopup();
        });

        // --- Initialization ---
        function initializeApp() {
            performRestartGame(); // Initial setup includes setting a target and updating UI

            const styleSheet = document.createElement("style");
            styleSheet.innerText = `
                #redSlider::-webkit-slider-thumb { background-color: var(--red-thumb-color, #EF4444); }
                #redSlider::-moz-range-thumb { background-color: var(--red-thumb-color, #EF4444); }
                #greenSlider::-webkit-slider-thumb { background-color: var(--green-thumb-color, #22C55E); }
                #greenSlider::-moz-range-thumb { background-color: var(--green-thumb-color, #22C55E); }
                #blueSlider::-webkit-slider-thumb { background-color: var(--blue-thumb-color, #3B82F6); }
                #blueSlider::-moz-range-thumb { background-color: var(--blue-thumb-color, #3B82F6); }
            `;
            document.head.appendChild(styleSheet);
            updateUserColor(); // Ensure thumbs pick up initial CSS var values
            renderHistory(); // Initial render of history (will show "no history")
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>

